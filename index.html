<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="monetag" content="07d875934d5f19d2e5f957632797918b">
    
    <!-- Default Meta Tags (Backend will replace these strings) -->
    <title>To The Point - Environment Energy and Agriculture</title>
    <meta name="description" content="Latest insights and articles on Environment, Energy, and Agriculture.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="To The Point - Environment Energy and Agriculture">
    <meta property="og:description" content="Latest insights and articles on Environment, Energy, and Agriculture. Click and read more.">
    <!-- Note: Python backend targets 'content=""' specifically for the image -->
    <meta property="og:image" content=""> 
    <meta property="og:url" content="https://blog.pranavblog.online">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; user-select: none; }
        
        /* Glassmorphism Utilities */
        .glass-nav { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.3); }
        .glass-morphism { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.85); box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.15); }
        
        .nature-gradient { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%); }
        
        /* Blog Typography */
        .blog-content p { margin-bottom: 1.2rem; line-height: 1.8; color: #374151; font-size: 0.97rem; }
        .blog-content h1, .blog-content h2, .blog-content h3 { color: #065f46; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.8rem; }
        .blog-content h1 { font-size: 1.8rem; }
        .blog-content h2 { font-size: 1.5rem; }
        .blog-content img { border-radius: 1rem; margin: 1.5rem auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 100%; height: auto; pointer-events: none; }
        .blog-content a { color: #059669; text-decoration: underline; }
        
        /* Utility */
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="nature-gradient min-h-screen text-gray-800" oncontextmenu="return false">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass-nav top-0">
        <div class="max-w-5xl mx-auto px-6 py-3">
            <a href="https://www.pranavblog.online/home" class="flex items-center gap-3 w-fit hover:opacity-80 transition-opacity">
                <i class="fas fa-leaf text-green-700 text-2xl"></i>
                <div class="flex flex-col">
                    <span class="font-bold text-2xl text-green-900 leading-none">To The Point</span>
                    <span class="text-[0.65rem] font-semibold text-green-700 tracking-wider uppercase mt-1">Environment Energy and Agriculture</span>
                </div>
            </a>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 md:px-6 max-w-4xl mx-auto min-h-screen flex flex-col">
        <!-- Loader -->
        <div id="loader" class="flex-1 flex flex-col items-center justify-center min-h-[60vh]">
            <i class="fas fa-seedling text-6xl text-green-500 mb-4 animate-bounce"></i>
            <h2 class="text-xl font-semibold text-green-800">Loading Article...</h2>
        </div>

        <!-- Error View -->
        <div id="errorView" class="hidden flex-1 flex flex-col items-center justify-center text-center p-8 glass-morphism rounded-3xl mt-10">
            <i class="fas fa-broken text-4xl text-red-400 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Article Not Found</h2>
            <p class="text-gray-600 mb-6">This link might be broken or expired.</p>
            <a href="https://www.pranavblog.online/home" class="px-6 py-2 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors shadow-lg">Go Home</a>
        </div>

        <!-- Main Blog Container -->
        <article id="blogContainer" class="hidden">
            <div class="glass-morphism rounded-3xl p-6 md:p-10 mb-10">
                <header class="mb-6 border-b border-green-100 pb-6">
                    <h1 id="blogTitle" class="text-2xl md:text-3xl font-bold text-green-950 leading-tight mb-4"></h1>
                    <div id="featuredImageContainer" class="w-full h-64 md:h-80 rounded-2xl overflow-hidden shadow-lg hidden mb-6">
                        <img id="featuredImage" src="" alt="Blog Featured Image" class="w-full h-full object-cover">
                    </div>
                </header>
                <div id="blogBody" class="blog-content text-gray-700"></div>
            </div>

            <!-- Recommendations Section -->
            <section id="recommendationsSection" class="hidden mt-12 mb-20 border-t border-green-200/50 pt-8">
                <h3 class="text-2xl font-bold text-green-900 mb-6 flex items-center gap-2">
                    <i class="fas fa-book-open text-green-600"></i> More to Read
                </h3>
                <div id="recGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Recommendation cards injected here -->
                </div>
            </section>
        </article>
    </main>

    <script>
        const WP_SITE = 'pranavcea.wordpress.com';

        // Initialize Blog View
        async function init() {
            // Check if Server Data Exists (Injected by Python Backend)
            if (window.SERVER_DATA && window.SERVER_DATA.wp_slug) {
                try {
                    const wpSlug = window.SERVER_DATA.wp_slug;
                    const recs = window.SERVER_DATA.recommendations || [];

                    // Fetch Main Content from WordPress
                    // We fetch content here to keep the backend response light
                    const wpRes = await fetch(`https://public-api.wordpress.com/rest/v1.1/sites/${WP_SITE}/posts/slug:${wpSlug}`);
                    
                    if (!wpRes.ok) throw new Error("WP Post Not Found");
                    
                    const post = await wpRes.json();

                    // Render Main Blog
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('blogContainer').classList.remove('hidden');
                    document.getElementById('blogTitle').innerText = post.title;
                    document.getElementById('blogBody').innerHTML = post.content;
                    
                    if(post.featured_image) {
                        document.getElementById('featuredImage').src = post.featured_image;
                        document.getElementById('featuredImageContainer').classList.remove('hidden');
                    }

                    // Load Recommendations
                    if (recs.length > 0) {
                        loadRecommendations(recs);
                    }

                    // Ads (Zone: 209738)
                    const adScript = document.createElement('script');
                    adScript.src = 'https://quge5.com/88/tag.min.js';
                    adScript.dataset.zone = '209738';
                    document.body.appendChild(adScript);

                } catch (err) {
                    console.error("Error loading blog:", err);
                    showError();
                }
            } else {
                // If accessed directly without backend data or invalid slug
                showError();
            }
        }

        function showError() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('errorView').classList.remove('hidden');
        }

        // Function to load recommendations
        async function loadRecommendations(recs) {
            const recSection = document.getElementById('recommendationsSection');
            const recGrid = document.getElementById('recGrid');
            recSection.classList.remove('hidden');

            // Process each recommendation in parallel
            const promises = recs.map(async (rec) => {
                try {
                    // Fetch details for the card (Title + Image)
                    const res = await fetch(`https://public-api.wordpress.com/rest/v1.1/sites/${WP_SITE}/posts/slug:${rec.wp_slug}?fields=title,featured_image,content`);
                    const data = await res.json();
                    
                    // Attach the CUSTOM domain link provided by backend
                    return { ...data, link: rec.link }; 
                } catch (e) { return null; }
            });

            const posts = await Promise.all(promises);

            posts.forEach(p => {
                if (p && p.title) {
                    // Determine which image to show
                    let displayImage = p.featured_image;

                    // Fallback: extract first <img> from content
                    if (!displayImage && p.content) {
                        const imgMatch = p.content.match(/<img[^>]+src="([^">]+)"/);
                        if (imgMatch && imgMatch[1]) {
                            displayImage = imgMatch[1];
                        }
                    }

                    // Render Image or Fallback (Leaf Icon)
                    const imgHtml = displayImage 
                        ? `<div class="h-40 w-full overflow-hidden bg-gray-100"><img src="${displayImage}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"></div>` 
                        : `<div class="h-40 w-full bg-green-50 flex items-center justify-center"><i class="fas fa-leaf text-green-200 text-4xl"></i></div>`;

                    const card = document.createElement('a');
                    card.href = p.link; // This uses your domain (e.g. /abc)
                    card.className = "glass-morphism glass-card rounded-xl overflow-hidden group block text-left";
                    card.innerHTML = `
                        ${imgHtml}
                        <div class="p-5">
                            <h4 class="font-bold text-green-900 leading-tight mb-2 group-hover:text-green-700 transition-colors line-clamp-2">${p.title}</h4>
                            <div class="text-xs text-gray-500 font-semibold uppercase tracking-wide mt-2">Read Article <i class="fas fa-arrow-right ml-1"></i></div>
                        </div>
                    `;
                    recGrid.appendChild(card);
                }
            });
        }

        // Start
        init();
    </script>
</body>
</html>
